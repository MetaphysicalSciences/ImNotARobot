<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced 2D Water Simulation</title>
  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.17.1/build/matter.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fluid-canvas@latest"></script>
  <style>
    body, html { margin: 0; padding: 0; overflow: hidden; }
    canvas { display: block; }
    #controls { position: absolute; top: 10px; left: 10px; z-index: 100; }
    .slider { margin: 10px 0; }
    .slider input { width: 200px; }
  </style>
</head>
<body>
  <div id="controls">
    <div class="slider">
      <label for="density">Density: </label>
      <input type="range" id="density" min="0.01" max="0.1" step="0.01" value="0.05">
      <span id="densityValue">0.05</span>
    </div>
    <div class="slider">
      <label for="viscosity">Viscosity: </label>
      <input type="range" id="viscosity" min="0.01" max="0.1" step="0.01" value="0.05">
      <span id="viscosityValue">0.05</span>
    </div>
    <button id="spawnCube">Spawn Cube</button>
  </div>

  <canvas id="fluidCanvas"></canvas>

  <script>
    const canvas = document.getElementById('fluidCanvas');
    const densitySlider = document.getElementById('density');
    const viscositySlider = document.getElementById('viscosity');
    const spawnCubeButton = document.getElementById('spawnCube');
    const densityValue = document.getElementById('densityValue');
    const viscosityValue = document.getElementById('viscosityValue');

    let engine, world, fluid, spawnArea;
    let cube;

    function setup() {
      resizeCanvas();
      engine = Matter.Engine.create();
      world = engine.world;
      fluid = new Fluid(canvas);
      fluid.activate();
      spawnArea = { x: canvas.width / 2, y: canvas.height - 50, width: 100, height: 20 };

      Matter.World.add(world, [
        Matter.Bodies.rectangle(spawnArea.x, spawnArea.y, spawnArea.width, spawnArea.height, { isStatic: true })
      ]);

      Matter.Events.on(engine, 'beforeUpdate', () => {
        fluid.setDensity(densitySlider.value);
        fluid.setViscosity(viscositySlider.value);
      });

      Matter.Engine.run(engine);
      fluid.render();
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function spawnCube() {
      if (cube) {
        Matter.World.remove(world, cube);
      }
      cube = Matter.Bodies.rectangle(spawnArea.x, spawnArea.y - 100, 40, 40, { restitution: 0.9 });
      Matter.World.add(world, cube);
    }

    window.addEventListener('resize', resizeCanvas);
    spawnCubeButton.addEventListener('click', spawnCube);

    densitySlider.addEventListener('input', () => {
      densityValue.textContent = densitySlider.value;
    });

    viscositySlider.addEventListener('input', () => {
      viscosityValue.textContent = viscositySlider.value;
    });

    setup();
  </script>
</body>
</html>
