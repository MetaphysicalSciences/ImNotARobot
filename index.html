<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Water Simulation</title>
<style>
body,html{margin:0;padding:0;overflow:hidden;background:#111}canvas{display:block}
</style>
</head>
<body>
<canvas></canvas>
<script>
const c=document.querySelector("canvas"),ctx=c.getContext("2d");
let w=innerWidth,h=innerHeight;c.width=w;c.height=h;
const cols=Math.floor(w/5),rows=Math.floor(h/2);
let water=[];
const gravity=0.2,spread=0.25,damping=0.99;

for(let x=0;x<cols;x++){
  water[x]=[];
  for(let y=0;y<rows;y++){
    water[x][y]={height:h/2,velocity:0,target:h/2};
  }
}

let tiltX=0;
if(window.DeviceOrientationEvent){
  window.addEventListener("deviceorientation",e=>{
    tiltX=e.gamma/50;
  });
}

let mouse={x:0,y:0,down:false};
document.addEventListener("mousedown",e=>{mouse.down=true;mouse.x=e.clientX;mouse.y=e.clientY});
document.addEventListener("mouseup",()=>{mouse.down=false});
document.addEventListener("mousemove",e=>{mouse.x=e.clientX;mouse.y=e.clientY});
document.addEventListener("touchstart",e=>{mouse.down=true;mouse.x=e.touches[0].clientX;mouse.y=e.touches[0].clientY});
document.addEventListener("touchmove",e=>{mouse.x=e.touches[0].clientX;mouse.y=e.touches[0].clientY});
document.addEventListener("touchend",()=>{mouse.down=false});

function updateWater(){
  for(let x=0;x<cols;x++){
    for(let y=0;y<rows;y++){
      let p=water[x][y];
      p.velocity+=(p.target-p.height)*gravity;
      p.height+=p.velocity;
      p.velocity*=damping;
    }
  }
  let leftDeltas=new Array(cols).fill(0);
  let rightDeltas=new Array(cols).fill(0);
  for(let i=0;i<8;i++){
    for(let x=0;x<cols;x++){
      for(let y=0;y<rows;y++){
        if(x>0){
          leftDeltas[x]=spread*(water[x][y].height-water[x-1][y].height);
          water[x-1][y].velocity+=leftDeltas[x];
        }
        if(x<cols-1){
          rightDeltas[x]=spread*(water[x][y].height-water[x+1][y].height);
          water[x+1][y].velocity+=rightDeltas[x];
        }
      }
    }
  }
  for(let x=0;x<cols;x++){
    for(let y=0;y<rows;y++){
      water[x][y].height+=tiltX;
    }
  }
  if(mouse.down){
    let mx=Math.floor(mouse.x/5);
    let my=Math.floor(mouse.y/5);
    if(mx>=0&&mx<cols&&my>=0&&my<rows){
      water[mx][my].velocity=-10;
    }
  }
}

function drawWater(){
  ctx.fillStyle="#111";ctx.fillRect(0,0,w,h);
  ctx.strokeStyle="#00f";ctx.lineWidth=2;
  for(let y=0;y<rows-1;y++){
    ctx.beginPath();
    for(let x=0;x<cols;x++){
      ctx.lineTo(x*5,water[x][y].height);
    }
    ctx.stroke();
  }
}

function loop(){
  requestAnimationFrame(loop);
  updateWater();
  drawWater();
}

loop();
window.addEventListener("resize",()=>{w=innerWidth;h=innerHeight;c.width=w;c.height=h;});
</script>
</body>
</html>
