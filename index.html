<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1, minimum-scale=1">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#000;height:100%;touch-action:none;-webkit-user-select:none;-ms-touch-action:none;}
canvas{display:block;background:#111;}
#joystick{position:absolute;bottom:50px;left:50px;width:100px;height:100px;border-radius:50%;background:rgba(255,255,255,0.2);touch-action:none;}
#stick{position:absolute;top:35px;left:35px;width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,0.5);}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="joystick"><div id="stick"></div></div>
<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
let w=canvas.width=window.innerWidth;
let h=canvas.height=window.innerHeight;
window.addEventListener('resize',()=>{w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;});

const grid=20;
let snake=[{x:10,y:10}];
let dir={x:1,y:0};
let food={x:5,y:5};
let speed=5;
let frame=0;
function gameLoop(){
    requestAnimationFrame(gameLoop);
    frame++;
    if(frame<60/speed) return;
    frame=0;
    let head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
    if(head.x<0) head.x=Math.floor(w/grid)-1;
    if(head.x>=Math.floor(w/grid)) head.x=0;
    if(head.y<0) head.y=Math.floor(h/grid)-1;
    if(head.y>=Math.floor(h/grid)) head.y=0;
    for(let s of snake) if(s.x===head.x&&s.y===head.y){snake=[{x:10,y:10}];dir={x:1,y:0};}
    snake.unshift(head);
    if(head.x===food.x&&head.y===food.y){food={x:Math.floor(Math.random()*Math.floor(w/grid)),y:Math.floor(Math.random()*Math.floor(h/grid))};}else{snake.pop();}
    ctx.fillStyle="#111";
    ctx.fillRect(0,0,w,h);
    ctx.fillStyle="#0f0";
    for(let s of snake) ctx.fillRect(s.x*grid,s.y*grid,grid-2,grid-2);
    ctx.fillStyle="#f00";
    ctx.fillRect(food.x*grid,food.y*grid,grid-2,grid-2);
}
gameLoop();

const joystick=document.getElementById('joystick');
const stick=document.getElementById('stick');
let active=false;
let startX=0,startY=0;

function limitDir(x,y){
    if(Math.abs(x)>Math.abs(y)){
        dir={x:x>0?1:-1,y:0};
    }else{
        dir={x:0,y:y>0?1:-1};
    }
}

joystick.addEventListener('touchstart',e=>{e.preventDefault();active=true;startX=e.touches[0].clientX;startY=e.touches[0].clientY;});
joystick.addEventListener('touchmove',e=>{
    if(!active) return;
    let tx=e.touches[0].clientX-startX;
    let ty=e.touches[0].clientY-startY;
    let dist=Math.min(40,Math.hypot(tx,ty));
    let angle=Math.atan2(ty,tx);
    stick.style.transform=`translate(${dist*Math.cos(angle)}px,${dist*Math.sin(angle)}px)`;
    limitDir(tx,ty);
});
joystick.addEventListener('touchend',e=>{active=false;stick.style.transform='translate(0,0)';});

document.addEventListener('gesturestart', e => e.preventDefault());
document.addEventListener('dblclick', e => e.preventDefault());
document.addEventListener('touchmove', e => {if(e.scale!==1)e.preventDefault();},{passive:false});
</script>
</body>
</html>
