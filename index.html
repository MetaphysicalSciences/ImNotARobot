<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Planetary Destruction</title>
<style>
body{margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#111;color:#fff}
canvas{background:#222}
button{margin-top:10px;padding:10px 20px;font-size:16px}
</style>
</head>
<body>
<canvas id="c"></canvas>
<button id="launch">Launch Square</button>
<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
canvas.width=400;
canvas.height=400;
let circle={x:200,y:200,r:80,img:null,angle:0};
let squares=[];
function createCircleImage(){
    let temp=document.createElement("canvas");
    temp.width=temp.height=circle.r*2;
    let tctx=temp.getContext("2d");
    tctx.fillStyle="orange";
    tctx.beginPath();
    tctx.arc(circle.r,circle.r,circle.r,0,Math.PI*2);
    tctx.fill();
    return tctx.getImageData(0,0,temp.width,temp.height);
}
circle.img=createCircleImage();
function drawCircle(){
    let data=circle.img;
    ctx.save();
    ctx.translate(circle.x,circle.y);
    ctx.rotate(circle.angle);
    ctx.translate(-circle.r,-circle.r);
    ctx.putImageData(data,0,0);
    ctx.restore();
}
function launchSquare(){
    squares.push({x:200,y:380,size:20,vx:0,vy:-5});
}
document.getElementById("launch").onclick=launchSquare;
function update(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    circle.angle+=0.02;
    drawCircle();
    for(let s of squares){
        s.x+=s.vx;
        s.y+=s.vy;
        ctx.fillStyle="red";
        ctx.fillRect(s.x-s.size/2,s.y-s.size/2,s.size,s.size);
        checkCollision(s);
    }
    squares=squares.filter(s=>s.y+s.size>0);
    requestAnimationFrame(update);
}
function checkCollision(s){
    let data=circle.img.data;
    let cx=Math.floor(s.x-circle.x+circle.r);
    let cy=Math.floor(s.y-circle.y+circle.r);
    if(cx>=0&&cx<circle.r*2&&cy>=0&&cy<circle.r*2){
        let idx=(cy*circle.r*2+cx)*4;
        if(data[idx+3]>0){
            for(let y=-2;y<=2;y++){
                for(let x=-2;x<=2;x++){
                    let nx=cx+x;
                    let ny=cy+y;
                    if(nx>=0&&nx<circle.r*2&&ny>=0&&ny<circle.r*2){
                        data[(ny*circle.r*2+nx)*4+3]=0;
                    }
                }
            }
            s.vy=0;
        }
    }
}
update();
</script>
</body>
</html>
