<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#c0c0c0;font-family:Arial;}
canvas{display:block;background:#fff;border:2px solid #000;}
#joystick{position:absolute;bottom:50px;left:50px;width:100px;height:100px;border-radius:50%;background:#999;}
#stick{position:absolute;top:35px;left:35px;width:30px;height:30px;border-radius:50%;background:#666;}
#score{position:absolute;top:20px;left:50%;transform:translateX(-50%);font-size:24px;color:#000;}
#menu{position:absolute;top:0;left:0;width:100%;height:100%;background:#008080;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;}
#menu h1{font-size:50px;margin-bottom:30px;}
#menu button{margin:10px;padding:10px 25px;font-size:20px;background:#fff;color:#000;border:none;cursor:pointer;}
#settings{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:#004040;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;}
#settings label{margin:5px;font-size:18px;}
#settings select, #settings input{margin:5px;padding:5px;font-size:16px;}
#settings button{margin-top:20px;padding:10px 20px;font-size:18px;background:#fff;color:#000;border:none;cursor:pointer;}
#lose{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:#808080;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#000;}
#lose button{margin-top:20px;padding:10px 20px;font-size:20px;background:#fff;color:#000;border:none;cursor:pointer;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="joystick"><div id="stick"></div></div>
<div id="score">0</div>

<div id="menu">
<h1>Snake 2025</h1>
<button id="startBtn">Start</button>
<button id="settingsBtn">Settings</button>
</div>

<div id="settings">
<label>Snake Shape:</label>
<select id="snakeShape">
<option value="block">Block</option>
<option value="round">Round</option>
<option value="diamond">Diamond</option>
</select>

<label>Snake Color:</label>
<select id="snakeColor">
<option value="#000">Black</option>
<option value="#008000">Green</option>
<option value="#0000ff">Blue</option>
<option value="#ff0000">Red</option>
<option value="#800080">Purple</option>
</select>

<label>Speed:</label>
<select id="speedSel">
<option value="5">Slow</option>
<option value="10" selected>Normal</option>
<option value="15">Fast</option>
<option value="20">Very Fast</option>
</select>

<label>Grid Size:</label>
<select id="gridSel">
<option value="15">Small</option>
<option value="20" selected>Medium</option>
<option value="25">Large</option>
<option value="30">Extra Large</option>
</select>

<label>Fruit Type:</label>
<select id="fruitType">
<option value="simple">Simple</option>
<option value="star">Star</option>
<option value="block">Block</option>
<option value="random">Random</option>
</select>

<label>Score Multiplier:</label>
<select id="scoreMult">
<option value="1">1x</option>
<option value="2">2x</option>
<option value="3" selected>3x</option>
<option value="5">5x</option>
</select>

<label>Joystick Size:</label>
<select id="joySize">
<option value="80">Small</option>
<option value="100" selected>Medium</option>
<option value="120">Large</option>
<option value="150">Huge</option>
</select>

<button id="backBtn">Back</button>
</div>

<div id="lose">
<h2>You Lost!</h2>
<button id="retry">Retry</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;
window.addEventListener('resize',()=>{w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;});

let snake=[],snakeLength=5,dir={x:1,y:0},nextDir={x:1,y:0},grid=20,speed=10,moveTimer=0,score=0,playing=false,over=false;
let fruit={x:10,y:10,type:"simple"};
let snakeShape="block",snakeColor="#000",fruitType="simple",scoreMultiplier=3;

function resetSnake(){
    snake=[];
    for(let i=0;i<snakeLength;i++){snake.push({x:Math.floor(w/2/grid)-i,y:Math.floor(h/2/grid)});}
}
function spawnFruit(){
    fruit.x = Math.floor(Math.random() * Math.floor(w/grid));
    fruit.y = Math.floor(Math.random() * Math.floor(h/grid));
    const types=["simple","star","block","random"];
    fruit.type = types[Math.floor(Math.random()*types.length)];
}
function resetGame(){snakeLength=5;score=0;over=false;resetSnake();spawnFruit();moveTimer=0;}
function drawSnake(){
    ctx.fillStyle=snakeColor;
    for(let s of snake){
        if(snakeShape=="block"){ctx.fillRect(s.x*grid,s.y*grid,grid,grid);}
        else if(snakeShape=="round"){ctx.beginPath();ctx.arc(s.x*grid+grid/2,s.y*grid+grid/2,grid/2,0,Math.PI*2);ctx.fill();}
        else if(snakeShape=="diamond"){ctx.save();ctx.translate(s.x*grid+grid/2,s.y*grid+grid/2);ctx.rotate(Math.PI/4);ctx.fillRect(-grid/2,-grid/2,grid,grid);ctx.restore();}
    }
}
function drawFruit(){
    ctx.fillStyle="#f00";
    if(fruit.type=="simple"){ctx.fillRect(fruit.x*grid,fruit.y*grid,grid,grid);}
    else if(fruit.type=="star"){ctx.beginPath();ctx.moveTo(fruit.x*grid+grid/2,fruit.y*grid);for(let i=0;i<5;i++){ctx.lineTo(fruit.x*grid+grid/2+grid/2*Math.cos(i*2*Math.PI/5-1.57),fruit.y*grid+grid/2+grid/2*Math.sin(i*2*Math.PI/5-1.57));}ctx.closePath();ctx.fill();}
    else if(fruit.type=="block"){ctx.fillRect(fruit.x*grid,fruit.y*grid,grid,grid);}
    else{ctx.beginPath();ctx.arc(fruit.x*grid+grid/2,fruit.y*grid+grid/2,grid/2,0,Math.PI*2);ctx.fill();}
}
function moveSnake(dt){
    moveTimer+=dt*speed;
    if(moveTimer>=1){
        moveTimer=0;
        dir = nextDir;
        let head = {x:snake[0].x+dir.x,y:snake[0].y+dir.y};
        if(head.x<0)head.x=Math.floor(w/grid)-1;
        if(head.y<0)head.y=Math.floor(h/grid)-1;
        if(head.x>=Math.floor(w/grid))head.x=0;
        if(head.y>=Math.floor(h/grid))head.y=0;
        for(let s of snake){if(s.x==head.x && s.y==head.y){over=true;playing=false;document.getElementById("lose").style.display="flex";return;}}
        snake.unshift(head);
        if(head.x==fruit.x && head.y==fruit.y){score+=1*scoreMultiplier;snakeLength++;spawnFruit();}
        else{snake.pop();}
    }
}
let lastTime=0;
function gameLoop(time){
    let dt=(time-lastTime)/1000;
    lastTime=time;
    if(playing && !over){
        moveSnake(dt);
        ctx.clearRect(0,0,w,h);
        drawFruit();
        drawSnake();
        document.getElementById("score").textContent=score;
        requestAnimationFrame(gameLoop);
    }
}

const joystick=document.getElementById("joystick");
const stick=document.getElementById("stick");
let active=false,sx=0,sy=0;
joystick.addEventListener("touchstart",e=>{active=true;sx=e.touches[0].clientX;sy=e.touches[0].clientY;});
joystick.addEventListener("touchmove",e=>{if(!active)return;let tx=e.touches[0].clientX-sx,ty=e.touches[0].clientY-sy;let angle=Math.atan2(ty,tx);stick.style.transform=`translate(${Math.min(40,Math.hypot(tx,ty))*Math.cos(angle)}px,${Math.min(40,Math.hypot(tx,ty))*Math.sin(angle)}px)`;if(Math.abs(tx)>Math.abs(ty)){nextDir={x:tx>0?1:-1,y:0};}else{nextDir={x:0,y:ty>0?1:-1};}});
joystick.addEventListener("touchend",()=>{active=false;stick.style.transform="translate(0,0)";});

document.addEventListener('gesturestart',e=>e.preventDefault());
document.addEventListener('dblclick',e=>e.preventDefault());
document.addEventListener('touchmove',e=>{if(e.scale!==1)e.preventDefault();},{passive:false});

document.getElementById("startBtn").onclick=()=>{document.getElementById("menu").style.display="none";playing=true;resetGame();requestAnimationFrame(gameLoop);}
document.getElementById("settingsBtn").onclick=()=>{document.getElementById("menu").style.display="none";document.getElementById("settings").style.display="flex";}
document.getElementById("backBtn").onclick=()=>{
    snakeShape=document.getElementById("snakeShape").value;
    snakeColor=document.getElementById("snakeColor").value;
    speed=parseInt(document.getElementById("speedSel").value);
    grid=parseInt(document.getElementById("gridSel").value);
    fruitType=document.getElementById("fruitType").value;
    scoreMultiplier=parseInt(document.getElementById("scoreMult").value);
    document.getElementById("settings").style.display="none";
    document.getElementById("menu").style.display="flex";
};
document.getElementById("retry").onclick=()=>{resetGame();document.getElementById("lose").style.display="none";playing=true;requestAnimationFrame(gameLoop);}
</script>
</body>
</html>
