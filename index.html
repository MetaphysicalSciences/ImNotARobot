<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#000;height:100%;touch-action:none;-webkit-user-select:none;}
canvas{display:block;background:radial-gradient(circle at center,#111,#000);}
#joystick{position:absolute;bottom:60px;left:60px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,0.08);}
#stick{position:absolute;top:45px;left:45px;width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,0.3);}
#score{position:absolute;top:20px;left:50%;transform:translateX(-50%);font-family:sans-serif;color:#0f0;font-size:28px;text-shadow:0 0 10px #0f0;}
#lose{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);justify-content:center;align-items:center;flex-direction:column;font-family:sans-serif;color:#fff;}
#lose button{margin-top:30px;font-size:22px;padding:12px 25px;background:#0f0;border:none;border-radius:8px;color:#000;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="joystick"><div id="stick"></div></div>
<div id="score">0</div>
<div id="lose"><div id="msg">You Lost!</div><button id="retry">Retry</button></div>
<script>
const c=document.getElementById('game'),x=c.getContext('2d');
let w=c.width=innerWidth,h=c.height=innerHeight,grid=20;
addEventListener('resize',()=>{w=c.width=innerWidth;h=c.height=innerHeight;});
let snake=[{x:10,y:10}],dir={x:1,y:0},nextDir={x:1,y:0},fruit={x:15,y:10,t:0},score=0,spd=6,moveTimer=0,over=false;
const fruitColors=["#f00","#0ff","#ff0"];
function newFruit(){
 let r=Math.random(),t=r<.8?0:r<.97?1:2;
 fruit={x:Math.floor(Math.random()*Math.floor(w/grid)),y:Math.floor(Math.random()*Math.floor(h/grid)),t};
}
function reset(){
 snake=[{x:10,y:10}];dir={x:1,y:0};nextDir={x:1,y:0};score=0;newFruit();over=false;document.getElementById('lose').style.display='none';
}
function update(dt){
 moveTimer+=dt;
 if(moveTimer>1/spd){
  moveTimer=0;dir=nextDir;
  let head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
  if(head.x<0)head.x=Math.floor(w/grid)-1;
  if(head.y<0)head.y=Math.floor(h/grid)-1;
  if(head.x>=Math.floor(w/grid))head.x=0;
  if(head.y>=Math.floor(h/grid))head.y=0;
  for(let i=0;i<snake.length;i++){if(snake[i].x===head.x&&snake[i].y===head.y){over=true;document.getElementById('lose').style.display='flex';return;}}
  snake.unshift(head);
  if(head.x===fruit.x&&head.y===fruit.y){
   let add=fruit.t===0?1:fruit.t===1?3:5;score+=add*10;for(let i=0;i<add-1;i++)snake.push({...snake[snake.length-1]});newFruit();
  }else snake.pop();
 }
}
function draw(){
 x.clearRect(0,0,w,h);
 for(let i=0;i<snake.length;i++){
  let s=snake[i];
  let glow=7-i/snake.length*5;
  x.fillStyle=`hsl(${120-(i/snake.length)*60},100%,50%)`;
  x.shadowBlur=glow;x.shadowColor=x.fillStyle;
  x.fillRect(s.x*grid,s.y*grid,grid-1,grid-1);
 }
 x.shadowBlur=15;x.fillStyle=fruitColors[fruit.t];x.shadowColor=fruitColors[fruit.t];
 x.beginPath();x.arc(fruit.x*grid+grid/2,fruit.y*grid+grid/2,grid/2,0,Math.PI*2);x.fill();
 x.shadowBlur=0;
 document.getElementById('score').textContent=score;
}
let last=0;
function loop(t){
 let dt=(t-last)/1000;last=t;if(!over){update(dt);draw();requestAnimationFrame(loop);}
}
requestAnimationFrame(loop);
const j=document.getElementById('joystick'),s=document.getElementById('stick');
let act=false,sx=0,sy=0;
function dirLimit(x,y){if(Math.abs(x)>Math.abs(y)){nextDir={x:x>0?1:-1,y:0};}else{nextDir={x:0,y:y>0?1:-1};}}
j.addEventListener('touchstart',e=>{e.preventDefault();act=true;sx=e.touches[0].clientX;sy=e.touches[0].clientY;});
j.addEventListener('touchmove',e=>{
 if(!act)return;
 let tx=e.touches[0].clientX-sx,ty=e.touches[0].clientY-sy;
 let d=Math.min(40,Math.hypot(tx,ty)),a=Math.atan2(ty,tx);
 s.style.transform=`translate(${d*Math.cos(a)}px,${d*Math.sin(a)}px)`;dirLimit(tx,ty);
});
j.addEventListener('touchend',()=>{act=false;s.style.transform='translate(0,0)';});
document.addEventListener('gesturestart',e=>e.preventDefault());
document.addEventListener('dblclick',e=>e.preventDefault());
document.addEventListener('touchmove',e=>{if(e.scale!==1)e.preventDefault();},{passive:false});
document.getElementById('retry').onclick=()=>{reset();requestAnimationFrame(loop);}
newFruit();
</script>
</body>
</html>
